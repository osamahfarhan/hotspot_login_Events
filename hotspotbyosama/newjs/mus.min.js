(function(l,u){"object"===typeof exports&&exports&&"string"!==typeof exports.nodeName?u(exports):"function"===typeof define&&define.amd?define(["exports"],u):(l.Mustache={},u(l.Mustache))})(this,function(l){function u(a){return"function"===typeof a}function B(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function D(a,b){return null!=a&&"object"===typeof a&&b in a}function F(a,b){function c(r){"string"===typeof r&&(r=r.split(G,2));if(!z(r)||2!==r.length)throw Error("Invalid tags: "+r);
p=new RegExp(B(r[0])+"\\s*");t=new RegExp("\\s*"+B(r[1]));A=new RegExp("\\s*"+B("}"+r[1]))}if(!a)return[];var d=[],e=[],g=[],h=!1,f=!1,p,t,A;c(b||l.tags);for(var m=new y(a),v,k,q,w;!m.eos();){v=m.pos;if(q=m.scanUntil(p)){w=0;for(var H=q.length;w<H;++w)if(k=q.charAt(w),I.call(J,k)?f=!0:g.push(e.length),e.push(["text",k,v,v+1]),v+=1,"\n"===k){if(h&&!f)for(;g.length;)delete e[g.pop()];else g=[];f=h=!1}}if(!m.scan(p))break;h=!0;k=m.scan(K)||"name";m.scan(L);"="===k?(q=m.scanUntil(E),m.scan(E),m.scanUntil(t)):
"{"===k?(q=m.scanUntil(A),m.scan(M),m.scanUntil(t),k="&"):q=m.scanUntil(t);if(!m.scan(t))throw Error("Unclosed tag at "+m.pos);w=[k,q,v,m.pos];e.push(w);if("#"===k||"^"===k)d.push(w);else if("/"===k){k=d.pop();if(!k)throw Error('Unopened section "'+q+'" at '+v);if(k[1]!==q)throw Error('Unclosed section "'+k[1]+'" at '+v);}else"name"===k||"{"===k||"&"===k?f=!0:"="===k&&c(q)}if(k=d.pop())throw Error('Unclosed section "'+k[1]+'" at '+m.pos);return N(O(e))}function O(a){for(var b=[],c,d,e=0,g=a.length;e<
g;++e)if(c=a[e])"text"===c[0]&&d&&"text"===d[0]?(d[1]+=c[1],d[3]=c[3]):(b.push(c),d=c);return b}function N(a){for(var b=[],c=b,d=[],e,g=0,h=a.length;g<h;++g)switch(e=a[g],e[0]){case "#":case "^":c.push(e);d.push(e);c=e[4]=[];break;case "/":c=d.pop();c[5]=e[2];c=0<d.length?d[d.length-1][4]:b;break;default:c.push(e)}return b}function y(a){this.tail=this.string=a;this.pos=0}function x(a,b){this.view=a;this.cache={".":this.view};this.parent=b}function n(){this.cache={}}var P=Object.prototype.toString,
z=Array.isArray||function(a){return"[object Array]"===P.call(a)},I=RegExp.prototype.test,J=/\S/,Q={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},L=/\s*/,G=/\s+/,E=/\s*=/,M=/\s*\}/,K=/#|\^|\/|>|\{|&|=|!/;y.prototype.eos=function(){return""===this.tail};y.prototype.scan=function(a){a=this.tail.match(a);if(!a||0!==a.index)return"";a=a[0];this.tail=this.tail.substring(a.length);this.pos+=a.length;return a};y.prototype.scanUntil=function(a){a=this.tail.search(a);
switch(a){case -1:var b=this.tail;this.tail="";break;case 0:b="";break;default:b=this.tail.substring(0,a),this.tail=this.tail.substring(a)}this.pos+=b.length;return b};x.prototype.push=function(a){return new x(a,this)};x.prototype.lookup=function(a){var b=this.cache;if(b.hasOwnProperty(a))var c=b[a];else{for(var d=this,e,g,h=!1;d;){if(0<a.indexOf("."))for(c=d.view,e=a.split("."),g=0;null!=c&&g<e.length;)g===e.length-1&&(h=D(c,e[g])),c=c[e[g++]];else c=d.view[a],h=D(d.view,a);if(h)break;d=d.parent}b[a]=
c}u(c)&&(c=c.call(this.view));return c};n.prototype.clearCache=function(){this.cache={}};n.prototype.parse=function(a,b){var c=this.cache,d=c[a];null==d&&(d=c[a]=F(a,b));return d};n.prototype.render=function(a,b,c){var d=this.parse(a);b=b instanceof x?b:new x(b);return this.renderTokens(d,b,c,a)};n.prototype.renderTokens=function(a,b,c,d){for(var e="",g,h,f,p=0,t=a.length;p<t;++p)f=void 0,g=a[p],h=g[0],"#"===h?f=this.renderSection(g,b,c,d):"^"===h?f=this.renderInverted(g,b,c,d):">"===h?f=this.renderPartial(g,
b,c,d):"&"===h?f=this.unescapedValue(g,b):"name"===h?f=this.escapedValue(g,b):"text"===h&&(f=this.rawValue(g)),void 0!==f&&(e+=f);return e};n.prototype.renderSection=function(a,b,c,d){function e(A){return g.render(A,b,c)}var g=this,h="",f=b.lookup(a[1]);if(f){if(z(f))for(var p=0,t=f.length;p<t;++p)h+=this.renderTokens(a[4],b.push(f[p]),c,d);else if("object"===typeof f||"string"===typeof f||"number"===typeof f)h+=this.renderTokens(a[4],b.push(f),c,d);else if(u(f)){if("string"!==typeof d)throw Error("Cannot use higher-order sections without the original template");
f=f.call(b.view,d.slice(a[3],a[5]),e);null!=f&&(h+=f)}else h+=this.renderTokens(a[4],b,c,d);return h}};n.prototype.renderInverted=function(a,b,c,d){var e=b.lookup(a[1]);if(!e||z(e)&&0===e.length)return this.renderTokens(a[4],b,c,d)};n.prototype.renderPartial=function(a,b,c){if(c&&(a=u(c)?c(a[1]):c[a[1]],null!=a))return this.renderTokens(this.parse(a),b,c,a)};n.prototype.unescapedValue=function(a,b){var c=b.lookup(a[1]);if(null!=c)return c};n.prototype.escapedValue=function(a,b){var c=b.lookup(a[1]);
if(null!=c)return l.escape(c)};n.prototype.rawValue=function(a){return a[1]};l.name="mustache.js";l.version="2.2.1";l.tags=["{{","}}"];var C=new n;l.clearCache=function(){return C.clearCache()};l.parse=function(a,b){return C.parse(a,b)};l.render=function(a,b,c){if("string"!==typeof a)throw b=TypeError,a=z(a)?"array":typeof a,new b('Invalid template! Template should be a "string" but "'+a+'" was given as the first argument for mustache#render(template, view, partials)');return C.render(a,b,c)};l.to_html=
function(a,b,c,d){a=l.render(a,b,c);if(u(d))d(a);else return a};l.escape=function(a){return String(a).replace(/[&<>"'`=\/]/g,function(b){return Q[b]})};l.Scanner=y;l.Context=x;l.Writer=n});
